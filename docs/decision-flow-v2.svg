<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="1200" viewBox="0 0 1400 1200">
  <defs>
    <style>
      .box { fill:#ffffff; stroke:#111827; stroke-width:2; }
      .decision { fill:#fef3c7; stroke:#f59e0b; stroke-width:2; }
      .process { fill:#dbeafe; stroke:#3b82f6; stroke-width:2; }
      .success { fill:#d1fae5; stroke:#10b981; stroke-width:2; }
      .error { fill:#fee2e2; stroke:#ef4444; stroke-width:2; }
      .start { fill:#c7d2fe; stroke:#6366f1; stroke-width:3; }
      .swap { fill:#fbbf24; stroke:#f59e0b; stroke-width:2; }
      .title { font-family: Arial, Helvetica, sans-serif; font-size:14px; font-weight:600; fill:#111827; text-anchor:middle; }
      .text { font-family: Arial, Helvetica, sans-serif; font-size:12px; font-weight:400; fill:#374151; text-anchor:middle; }
      .header { font-family: Arial, Helvetica, sans-serif; font-size:28px; font-weight:700; fill:#111827; text-anchor:middle; }
      .line { stroke:#6b7280; stroke-width:2; fill:none; }
      .line-yes { stroke:#10b981; stroke-width:3; fill:none; }
      .line-no { stroke:#ef4444; stroke-width:3; fill:none; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#6b7280" />
    </marker>
    <marker id="arrow-yes" markerWidth="12" markerHeight="12" refX="10" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,8 L12,4 z" fill="#10b981" />
    </marker>
    <marker id="arrow-no" markerWidth="12" markerHeight="12" refX="10" refY="4" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,8 L12,4 z" fill="#ef4444" />
    </marker>
  </defs>

  <!-- Title -->
  <text class="header" x="700" y="40">RWA Raffle - Simplified Flow (1-Transaction Model)</text>

  <!-- START -->
  <ellipse class="start" cx="700" cy="100" rx="120" ry="40" />
  <text class="title" x="700" y="105">START</text>

  <!-- 1. Organizer Initializes -->
  <rect class="process" x="500" y="170" width="400" height="100" rx="8" ry="8" />
  <text class="title" x="700" y="200">1. Organizer Initializes Raffle</text>
  <text class="text" x="700" y="225">Required slots: 500 ($1 per slot = $500 total)</text>
  <text class="text" x="700" y="245">Deadline: 7 days | Prize: Luxury Watch NFT</text>
  <text class="text" x="700" y="260">Creates: Raffle PDA + USDC Escrow ATA</text>
  <line class="line" x1="700" y1="140" x2="700" y2="170" marker-end="url(#arrow)" />

  <!-- 2. User Picks Slots -->
  <rect class="process" x="500" y="310" width="400" height="100" rx="8" ry="8" />
  <text class="title" x="700" y="340">2. User Picks Slots</text>
  <text class="text" x="700" y="365">Frontend: User selects [1, 3, 24] (3 slots)</text>
  <text class="text" x="700" y="385">Quote (SDK/back-end): 3 slots × $1 = $3 USDC</text>
  <text class="text" x="700" y="400">Price via Pyth; swap via Jupiter → Need 1.2 MOGA</text>
  <line class="line" x1="700" y1="270" x2="700" y2="310" marker-end="url(#arrow)" />

  <!-- 3. ONE TRANSACTION: join_raffle -->
  <rect class="swap" x="450" y="450" width="500" height="180" rx="8" ry="8" />
  <text class="title" x="700" y="480" style="font-size:16px; font-weight:700;">3. ONE TRANSACTION: join_raffle()</text>
  
  <text class="text" x="470" y="510" text-anchor="start">Step 1: Validate slots [1,3,24] are available</text>
  <text class="text" x="470" y="530" text-anchor="start">Step 2: Get MOGA/USD price from Pyth oracle</text>
  <text class="text" x="470" y="550" text-anchor="start">Step 3: Jupiter CPI: Swap 1.2 MOGA → $3 USDC</text>
  <text class="text" x="470" y="570" text-anchor="start">Step 4: USDC goes to escrow ATA (Raffle PDA owned)</text>
  <text class="text" x="470" y="590" text-anchor="start">Step 5: Set bitmap bits [1,3,24] = occupied</text>
  <text class="text" x="470" y="610" text-anchor="start">Step 6: Set slot_owners[0,2,23] = user pubkey</text>
  
  <line class="line" x1="700" y1="410" x2="700" y2="450" marker-end="url(#arrow)" />

  <!-- 4. Threshold Check -->
  <path class="decision" d="M 700 680 L 850 740 L 700 800 L 550 740 Z" />
  <text class="title" x="700" y="735">4. Slots Full?</text>
  <text class="title" x="700" y="755">(500/500)</text>
  <line class="line" x1="700" y1="630" x2="700" y2="680" marker-end="url(#arrow)" />

  <!-- 4a. YES: Trigger Draw -->
  <rect class="success" x="250" y="850" width="300" height="100" rx="8" ry="8" />
  <text class="title" x="400" y="880">5a. Trigger Arcium Draw</text>
  <text class="text" x="400" y="905">State: Selling → Drawing</text>
  <text class="text" x="400" y="925">Arcium MPC generates winner slot (1-500)</text>
  <text class="text" x="400" y="940">draw_callback() sets winner</text>
  <line class="line-yes" x1="600" y1="780" x2="450" y2="850" marker-end="url(#arrow-yes)" />
  <text class="text" x="520" y="815" fill="#10b981" font-weight="600">YES</text>

  <!-- 4b. NO: Wait or Check Deadline -->
  <rect class="process" x="650" y="870" width="200" height="60" rx="8" ry="8" />
  <text class="title" x="750" y="895">Continue Selling</text>
  <text class="text" x="750" y="915">Wait for more users</text>
  <line class="line-no" x1="750" y1="800" x2="750" y2="870" marker-end="url(#arrow-no)" />
  <text class="text" x="760" y="835" fill="#ef4444" font-weight="600">NO</text>

  <!-- Loop back -->
  <path class="line" d="M 850 900 Q 1000 900 1000 740 Q 1000 500 900 500" marker-end="url(#arrow)" />

  <!-- Deadline Check (Parallel) -->
  <path class="decision" d="M 1100 500 L 1250 560 L 1100 620 L 950 560 Z" />
  <text class="title" x="1100" y="555">Deadline</text>
  <text class="title" x="1100" y="575">Passed?</text>
  <line class="line" x1="1100" y1="410" x2="1100" y2="500" marker-end="url(#arrow)" />
  <text class="text" x="1000" y="450" fill="#6b7280">Parallel check</text>

  <!-- Deadline YES: Refunding -->
  <rect class="error" x="950" y="680" width="300" height="100" rx="8" ry="8" />
  <text class="title" x="1100" y="710">State: REFUNDING</text>
  <text class="text" x="1100" y="735">Slots not full by deadline</text>
  <text class="text" x="1100" y="755">Users can claim refunds</text>
  <text class="text" x="1100" y="770">(Mint NFT tickets)</text>
  <line class="line-yes" x1="1100" y1="620" x2="1100" y2="680" marker-end="url(#arrow-yes)" />
  <text class="text" x="1110" y="650" fill="#10b981" font-weight="600">YES</text>

  <!-- Deadline NO: Continue -->
  <line class="line-no" x1="1180" y1="620" x2="1250" y2="680" marker-end="url(#arrow-no)" />
  <text class="text" x="1210" y="650" fill="#ef4444" font-weight="600">NO</text>
  <path class="line" d="M 1250 680 Q 1300 680 1300 560 Q 1300 440 1250 440" marker-end="url(#arrow)" />

  <!-- 6. Winner Claims -->
  <rect class="success" x="250" y="1000" width="300" height="80" rx="8" ry="8" />
  <text class="title" x="400" y="1030">6. Winner Claims Prize</text>
  <text class="text" x="400" y="1055">claim_prize(): Transfer NFT to winner</text>
  <text class="text" x="400" y="1070">Business withdraws $500 USDC</text>
  <line class="line" x1="400" y1="950" x2="400" y2="1000" marker-end="url(#arrow)" />

  <!-- END Success -->
  <ellipse class="success" cx="400" cy="1130" rx="100" ry="35" />
  <text class="title" x="400" y="1135">COMPLETED</text>
  <line class="line" x1="400" y1="1080" x2="400" y2="1095" marker-end="url(#arrow)" />

  <!-- Refund Flow -->
  <rect class="process" x="950" y="830" width="300" height="120" rx="8" ry="8" />
  <text class="title" x="1100" y="860">7. User Claims Refund</text>
  <text class="text" x="1100" y="885">claim_refund():</text>
  <text class="text" x="1100" y="905">• Mint NFT tickets (1 per slot)</text>
  <text class="text" x="1100" y="925">• Clear user's reserved slots</text>
  <text class="text" x="1100" y="940">• NFT tradeable; non-burnable by user</text>
  <line class="line" x1="1100" y1="780" x2="1100" y2="830" marker-end="url(#arrow)" />

  <!-- END Refund -->
  <ellipse class="success" cx="1100" cy="1000" rx="100" ry="35" />
  <text class="title" x="1100" y="1005">REFUNDED</text>
  <line class="line" x1="1100" y1="950" x2="1100" y2="965" marker-end="url(#arrow)" />

  <!-- Info Box: Key Features -->
  <rect class="box" x="50" y="50" width="350" height="280" rx="8" ry="8" />
  <text class="title" x="225" y="80" style="font-size:18px;">Key Features</text>
  
  <text class="text" x="70" y="110" text-anchor="start" font-weight="600">✓ 1-Transaction Join:</text>
  <text class="text" x="80" y="130" text-anchor="start">Pick slots → Pay MOGA → Done</text>
  
  <text class="text" x="70" y="160" text-anchor="start" font-weight="600">✓ Stable Escrow:</text>
  <text class="text" x="80" y="180" text-anchor="start">MOGA swapped to USDC immediately</text>
  <text class="text" x="80" y="195" text-anchor="start">Business always gets $500 USDC</text>
  
  <text class="text" x="70" y="220" text-anchor="start" font-weight="600">✓ Tradeable Refunds:</text>
  <text class="text" x="80" y="240" text-anchor="start">NFT tickets only minted on refund</text>
  <text class="text" x="80" y="255" text-anchor="start">Tradeable; recycling by platform only</text>
  
  <text class="text" x="70" y="280" text-anchor="start" font-weight="600">✓ Verifiable Randomness:</text>
  <text class="text" x="80" y="300" text-anchor="start">Arcium MPC for fair winner selection</text>
  <text class="text" x="80" y="315" text-anchor="start">No manipulation possible</text>

  <!-- Tech Stack Box -->
  <rect class="box" x="50" y="360" width="350" height="200" rx="8" ry="8" />
  <text class="title" x="225" y="390" style="font-size:18px;">Tech Stack</text>
  
  <text class="text" x="70" y="420" text-anchor="start" font-weight="600">Pyth Network:</text>
  <text class="text" x="80" y="440" text-anchor="start">On-chain MOGA/USD price oracle</text>
  
  <text class="text" x="70" y="465" text-anchor="start" font-weight="600">Jupiter Aggregator:</text>
  <text class="text" x="80" y="485" text-anchor="start">Best MOGA → USDC swap rates</text>
  
  <text class="text" x="70" y="510" text-anchor="start" font-weight="600">Metaplex Bubblegum:</text>
  <text class="text" x="80" y="530" text-anchor="start">Compressed NFTs for refund tickets</text>
  
  <text class="text" x="70" y="555" text-anchor="start" font-weight="600">Arcium MPC:</text>
  <text class="text" x="80" y="575" text-anchor="start">Verifiable randomness generation</text>

  <!-- Legend -->
  <rect class="box" x="50" y="590" width="350" height="180" rx="8" ry="8" />
  <text class="title" x="225" y="620">Legend</text>
  
  <ellipse class="start" cx="100" cy="650" rx="40" ry="20" />
  <text class="text" x="180" y="655" text-anchor="start">Start/End State</text>
  
  <rect class="process" x="80" y="675" width="40" height="25" rx="4" ry="4" />
  <text class="text" x="180" y="692" text-anchor="start">Process Step</text>
  
  <rect class="swap" x="80" y="710" width="40" height="25" rx="4" ry="4" />
  <text class="text" x="180" y="727" text-anchor="start">Swap Transaction</text>
  
  <path class="decision" d="M 100 740 L 120 750 L 100 760 L 80 750 Z" />
  <text class="text" x="180" y="755" text-anchor="start">Decision Point</text>
</svg>
