<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="1400" viewBox="0 0 1600 1400">
  <defs>
    <style>
      .box { fill:#ffffff; stroke:#111827; stroke-width:2; }
      .decision { fill:#fef3c7; stroke:#f59e0b; stroke-width:2; }
      .process { fill:#dbeafe; stroke:#3b82f6; stroke-width:2; }
      .success { fill:#d1fae5; stroke:#10b981; stroke-width:2; }
      .error { fill:#fee2e2; stroke:#ef4444; stroke-width:2; }
      .start { fill:#c7d2fe; stroke:#6366f1; stroke-width:3; }
      .title { font-family: Arial, Helvetica, sans-serif; font-size:14px; font-weight:600; fill:#111827; text-anchor:middle; }
      .text { font-family: Arial, Helvetica, sans-serif; font-size:12px; font-weight:400; fill:#374151; text-anchor:middle; }
      .header { font-family: Arial, Helvetica, sans-serif; font-size:28px; font-weight:700; fill:#111827; text-anchor:middle; }
      .line { stroke:#6b7280; stroke-width:2; fill:none; }
      .line-yes { stroke:#10b981; stroke-width:2; fill:none; }
      .line-no { stroke:#ef4444; stroke-width:2; fill:none; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#6b7280" />
    </marker>
    <marker id="arrow-yes" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#10b981" />
    </marker>
    <marker id="arrow-no" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#ef4444" />
    </marker>
  </defs>

  <!-- Title -->
  <text class="header" x="800" y="40">RWA Raffle - Complete Decision Flow</text>

  <!-- START -->
  <ellipse class="start" cx="800" cy="100" rx="100" ry="40" />
  <text class="title" x="800" y="105">START</text>

  <!-- 1. Initialize Raffle -->
  <rect class="process" x="650" y="170" width="300" height="80" rx="8" ry="8" />
  <text class="title" x="800" y="200">1. Initialize Raffle</text>
  <text class="text" x="800" y="220">Organizer creates raffle</text>
  <text class="text" x="800" y="235">Sets: required_tickets, deadline</text>
  <line class="line" x1="800" y1="140" x2="800" y2="170" marker-end="url(#arrow)" />

  <!-- 2. User Deposit Decision -->
  <path class="decision" d="M 800 250 L 950 310 L 800 370 L 650 310 Z" />
  <text class="title" x="800" y="305">2. User wants to</text>
  <text class="title" x="800" y="325">participate?</text>
  <line class="line" x1="800" y1="250" x2="800" y2="250" marker-end="url(#arrow)" />

  <!-- 2a. Deposit Type Decision -->
  <path class="decision" d="M 500 310 L 600 360 L 500 410 L 400 360 Z" />
  <text class="title" x="500" y="355">Use compressed</text>
  <text class="title" x="500" y="375">accounts?</text>
  <line class="line-yes" x1="650" y1="310" x2="600" y2="360" marker-end="url(#arrow-yes)" />
  <text class="text" x="620" y="330" fill="#10b981">YES</text>

  <!-- 2a1. Deposit Compressed -->
  <rect class="process" x="250" y="450" width="200" height="100" rx="8" ry="8" />
  <text class="title" x="350" y="480">deposit_compressed</text>
  <text class="text" x="350" y="500">• Transfer tokens</text>
  <text class="text" x="350" y="515">• Create Light ticket</text>
  <text class="text" x="350" y="530">• Update counters</text>
  <line class="line-yes" x1="450" y1="410" x2="400" y2="450" marker-end="url(#arrow-yes)" />
  <text class="text" x="420" y="430" fill="#10b981">YES</text>

  <!-- 2a2. Deposit Regular -->
  <rect class="process" x="550" y="450" width="200" height="100" rx="8" ry="8" />
  <text class="title" x="650" y="480">deposit</text>
  <text class="text" x="650" y="500">• Transfer tokens</text>
  <text class="text" x="650" y="515">• Create PDA ticket</text>
  <text class="text" x="650" y="530">• Update counters</text>
  <line class="line-no" x1="500" y1="410" x2="600" y2="450" marker-end="url(#arrow-no)" />
  <text class="text" x="540" y="430" fill="#ef4444">NO</text>

  <!-- 2b. Skip to Wait -->
  <rect class="process" x="1050" y="280" width="200" height="60" rx="8" ry="8" />
  <text class="title" x="1150" y="305">Wait for others</text>
  <text class="text" x="1150" y="325">to deposit</text>
  <line class="line-no" x1="950" y1="310" x2="1050" y2="310" marker-end="url(#arrow-no)" />
  <text class="text" x="1000" y="300" fill="#ef4444">NO</text>

  <!-- Merge deposits -->
  <circle class="box" cx="500" cy="600" r="20" />
  <line class="line" x1="350" y1="550" x2="490" y2="590" marker-end="url(#arrow)" />
  <line class="line" x1="650" y1="550" x2="510" y2="590" marker-end="url(#arrow)" />

  <!-- 3. Threshold Check -->
  <path class="decision" d="M 500 650 L 650 710 L 500 770 L 350 710 Z" />
  <text class="title" x="500" y="705">3. Tickets sold ==</text>
  <text class="title" x="500" y="725">required_tickets?</text>
  <line class="line" x1="500" y1="620" x2="500" y2="650" marker-end="url(#arrow)" />

  <!-- 3a. Threshold Reached -->
  <rect class="success" x="250" y="820" width="200" height="80" rx="8" ry="8" />
  <text class="title" x="350" y="850">Status: Drawing</text>
  <text class="text" x="350" y="870">Emit: ThresholdReached</text>
  <text class="text" x="350" y="885">Emit: RandomnessRequested</text>
  <line class="line-yes" x1="400" y1="770" x2="350" y2="820" marker-end="url(#arrow-yes)" />
  <text class="text" x="370" y="795" fill="#10b981">YES</text>

  <!-- 3b. Wait More -->
  <rect class="process" x="550" y="840" width="200" height="40" rx="8" ry="8" />
  <text class="title" x="650" y="865">Continue accepting</text>
  <line class="line-no" x1="600" y1="770" x2="650" y2="840" marker-end="url(#arrow-no)" />
  <text class="text" x="620" y="805" fill="#ef4444">NO</text>

  <!-- Loop back -->
  <path class="line" d="M 750 860 Q 900 860 900 710 Q 900 560 800 560" marker-end="url(#arrow)" />

  <!-- 4. Deadline Check (parallel) -->
  <path class="decision" d="M 1150 400 L 1300 460 L 1150 520 L 1000 460 Z" />
  <text class="title" x="1150" y="455">4. Deadline</text>
  <text class="title" x="1150" y="475">passed?</text>
  <line class="line" x1="1150" y1="340" x2="1150" y2="400" marker-end="url(#arrow)" />

  <!-- 4a. Deadline passed, threshold not met -->
  <rect class="error" x="1000" y="570" width="200" height="80" rx="8" ry="8" />
  <text class="title" x="1100" y="600">Status: Refunding</text>
  <text class="text" x="1100" y="620">Users can claim</text>
  <text class="text" x="1100" y="635">refunds</text>
  <line class="line-yes" x1="1100" y1="520" x2="1100" y2="570" marker-end="url(#arrow-yes)" />
  <text class="text" x="1110" y="545" fill="#10b981">YES</text>

  <!-- 4b. Continue -->
  <line class="line-no" x1="1200" y1="520" x2="1300" y2="600" marker-end="url(#arrow-no)" />
  <text class="text" x="1240" y="560" fill="#ef4444">NO</text>
  <path class="line" d="M 1300 600 Q 1350 600 1350 460 Q 1350 320 1250 310" marker-end="url(#arrow)" />

  <!-- 5. Randomness Method Decision -->
  <path class="decision" d="M 350 950 L 500 1010 L 350 1070 L 200 1010 Z" />
  <text class="title" x="350" y="1005">5. Use Arcium</text>
  <text class="title" x="350" y="1025">MPC?</text>
  <line class="line" x1="350" y1="900" x2="350" y2="950" marker-end="url(#arrow)" />

  <!-- 5a. Arcium Flow -->
  <rect class="process" x="50" y="1120" width="250" height="120" rx="8" ry="8" />
  <text class="title" x="175" y="1150">request_draw_arcium</text>
  <text class="text" x="175" y="1175">1. init_draw_comp_def</text>
  <text class="text" x="175" y="1190">2. queue_computation</text>
  <text class="text" x="175" y="1205">3. Arcium processes</text>
  <text class="text" x="175" y="1220">4. draw_callback</text>
  <line class="line-yes" x1="250" y1="1070" x2="175" y2="1120" marker-end="url(#arrow-yes)" />
  <text class="text" x="210" y="1095" fill="#10b981">YES</text>

  <!-- 5b. Manual Flow -->
  <rect class="process" x="400" y="1140" width="200" height="80" rx="8" ry="8" />
  <text class="title" x="500" y="1170">request_draw</text>
  <text class="text" x="500" y="1190">Emit event</text>
  <text class="text" x="500" y="1205">Offchain settles</text>
  <line class="line-no" x1="450" y1="1070" x2="500" y2="1140" marker-end="url(#arrow-no)" />
  <text class="text" x="470" y="1105" fill="#ef4444">NO</text>

  <!-- Merge randomness -->
  <circle class="box" cx="350" cy="1290" r="20" />
  <line class="line" x1="175" y1="1240" x2="340" y2="1280" marker-end="url(#arrow)" />
  <line class="line" x1="500" y1="1220" x2="360" y2="1280" marker-end="url(#arrow)" />

  <!-- 6. Winner Selected -->
  <rect class="success" x="250" y="1330" width="200" height="60" rx="8" ry="8" />
  <text class="title" x="350" y="1355">Status: Completed</text>
  <text class="text" x="350" y="1375">Winner ticket set</text>
  <line class="line" x1="350" y1="1310" x2="350" y2="1330" marker-end="url(#arrow)" />

  <!-- RIGHT SIDE: Winner Claims -->
  <rect class="process" x="700" y="950" width="200" height="80" rx="8" ry="8" />
  <text class="title" x="800" y="980">7. Winner Claims</text>
  <text class="text" x="800" y="1000">claim_win</text>
  <text class="text" x="800" y="1015">Mark on-chain</text>
  <line class="line" x1="500" y1="1010" x2="700" y2="990" marker-end="url(#arrow)" />

  <!-- 8. Prize NFT Decision -->
  <path class="decision" d="M 800 1080 L 950 1140 L 800 1200 L 650 1140 Z" />
  <text class="title" x="800" y="1135">8. Prize NFT</text>
  <text class="title" x="800" y="1155">set?</text>
  <line class="line" x1="800" y1="1030" x2="800" y2="1080" marker-end="url(#arrow)" />

  <!-- 8a. Claim Prize -->
  <rect class="success" x="950" y="1110" width="200" height="80" rx="8" ry="8" />
  <text class="title" x="1050" y="1140">claim_prize</text>
  <text class="text" x="1050" y="1160">Transfer NFT</text>
  <text class="text" x="1050" y="1175">to winner</text>
  <line class="line-yes" x1="950" y1="1140" x2="950" y2="1150" marker-end="url(#arrow-yes)" />
  <text class="text" x="960" y="1135" fill="#10b981">YES</text>

  <!-- 8b. Skip -->
  <rect class="process" x="700" y="1250" width="200" height="40" rx="8" ry="8" />
  <text class="title" x="800" y="1275">Offchain RWA delivery</text>
  <line class="line-no" x1="750" y1="1200" x2="800" y2="1250" marker-end="url(#arrow-no)" />
  <text class="text" x="770" y="1225" fill="#ef4444">NO</text>

  <!-- END -->
  <ellipse class="success" cx="800" cy="1350" rx="100" ry="40" />
  <text class="title" x="800" y="1355">COMPLETE</text>
  <line class="line" x1="800" y1="1290" x2="800" y2="1310" marker-end="url(#arrow)" />
  <line class="line" x1="1050" y1="1190" x2="900" y2="1340" marker-end="url(#arrow)" />

  <!-- Refund Path -->
  <rect class="process" x="1000" y="700" width="200" height="60" rx="8" ry="8" />
  <text class="title" x="1100" y="725">claim_refund</text>
  <text class="text" x="1100" y="745">Return tokens</text>
  <line class="line" x1="1100" y1="650" x2="1100" y2="700" marker-end="url(#arrow)" />

  <ellipse class="success" cx="1100" cy="810" rx="80" ry="30" />
  <text class="title" x="1100" y="815">REFUNDED</text>
  <line class="line" x1="1100" y1="760" x2="1100" y2="780" marker-end="url(#arrow)" />

  <!-- Legend -->
  <rect class="box" x="50" y="50" width="300" height="180" rx="8" ry="8" />
  <text class="title" x="200" y="75">Legend</text>
  <ellipse class="start" cx="100" cy="110" rx="40" ry="20" />
  <text class="text" x="180" y="115">Start/End</text>
  <rect class="process" x="80" y="135" width="40" height="20" rx="4" ry="4" />
  <text class="text" x="180" y="150">Process</text>
  <path class="decision" d="M 100 165 L 120 175 L 100 185 L 80 175 Z" />
  <text class="text" x="180" y="180">Decision</text>
  <rect class="success" x="80" y="195" width="40" height="20" rx="4" ry="4" />
  <text class="text" x="180" y="210">Success State</text>
</svg>
